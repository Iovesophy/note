---
title: "Golangã§æ—¥ä»˜ã®ç¹°ã‚Šè¿”ã—å‡¦ç†ã‚’æ‰±ã†"
emoji: "ğŸ“†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go,RRULE]
published: true
---

# Golangã§æ—¥ä»˜ã®ç¹°ã‚Šè¿”ã—å‡¦ç†ã‚’æ‰±ã†

ã“ã‚“ã«ã¡ã¯ã€ä»Šå›ã¯Golangã§æš¦ã‚’æ‰±ã†æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã€ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚
æš¦ã‚’è‡ªåœ¨ã«æ“ã£ã¦ã‚µã‚¯ãƒƒã¨Golangã§å ã„ã‚¢ãƒ—ãƒªã§ã‚‚ä½œã£ã¦ã¿ãŸã„ã§ã™ã­ã€‚

# Golangã«ãŠã‘ã‚‹æ™‚é–“

Golangã«ã¯æ¨™æº–ã§æ™‚é–“ã‚’æ‰±ã†ã“ã¨ãŒã§ãã‚‹æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã™ã€ã¾ãŸæ™‚é–“å‹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã°ã€ç¾åœ¨ã®æ™‚åˆ»ã¯æ¬¡ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```Go
package main

import (
	"fmt"
	"time"
)

func main() {
    fmt.Println(time.Now())
}
```

https://play.golang.org/p/CzmUKIlJCRU

ã§ã¯ã“ã“ã§å–å¾—ã—ãŸç¾åœ¨æ™‚åˆ»ã‚’èµ·ç‚¹ã¨ã—ã¦ä¸€å®šã®ç¹°ã‚Šè¿”ã—ã§æ—¥ä»˜ã‚’å–å¾—ã™ã‚‹éš›ã©ã†ã™ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ã€‚

# RRULEã«ã¤ã„ã¦
å®Ÿã¯ã€ç¹°ã‚Šè¿”ã—è¨­å®šã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã®ã«æœ‰ç”¨ãªå½¢å¼ãŒRFC2445ã¨ã—ã¦å®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

Internet Calendaring and Scheduling Core Object Specification
http://www.ietf.org/rfc/rfc2445.txt

ä»Šå›ã¯ã“ã®RRULEã‚’ç”¨ã„ã¦ç¹°ã‚Šè¿”ã—ã®æ—¥ä»˜ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
Golangã«ã¯ã„ãã¤ã‹RRULEã‚’å–å¾—ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå­˜åœ¨ã—ã¾ã™ã€‚
ä»Šå›ã¯æ¯”è¼ƒçš„Githubã®ã‚¹ã‚¿ãƒ¼æ•°ã®å¤šã„`rrule-go`ã‚’ä½¿ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://github.com/teambition/rrule-go

ä¾‹ãˆã°ç¾åœ¨ã®æ—¥æ™‚ã‹ã‚‰ç¹°ã‚Šè¿”ã—1é€±é–“ã®æ—¥æ™‚ã‚’ï¼•ã¤å–å¾—ã—ãŸã„å ´åˆã¯RRULEçš„ã«æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã§ãã¾ã™ã€‚

"DTSTART:ç¾åœ¨ã®æ—¥æ™‚\nFREQ=WEEKLY;INTERVAL=1;COUNT=5"

ã¾ãŸ`rrule-go`ã«ã¯ã“ã®RRULEã‚’æ–‡å­—åˆ—ã¨ã—ã¦æ¸¡ã—ã¦ã‚ã’ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚

```Go
package main

import (
	"fmt"
	"time"

	"github.com/teambition/rrule-go"
)

func main() {
	var timesetter string
	timesetter = time.Now().Format("20060102T150405Z")
	rruleInstance := "DTSTART:" + timesetter + "\n" + "FREQ=WEEKLY;INTERVAL=1;COUNT=5"
	s, err := rrule.StrToRRule(rruleInstance)
	if err != nil {
		fmt.Println("Rrule error",err)
	}
	fmt.Println(s.All())
}
```

https://play.golang.org/p/1jfzbKJrih2

ã“ã®ã‚ˆã†ã«éå¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
RRULEã®è¡¨ç¾æ–¹æ³•ã¯ãŸãã•ã‚“ã‚ã£ã¦è¿½ã„ãã‚Œãªã„ã®ã§ã“ã“ã§ã¯ä¸Šè¿°ã®ä¾‹ã«ç•™ã‚ã¾ã™ãŒã€å®Ÿéš›ã«åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ãã®ç”¨é€”ã«å¿œã˜ãŸRRULEæ–‡å­—åˆ—ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€æ–‡å­—åˆ—ã‚’ä½œã‚‹é–¢æ•°ã‚’åˆ¥é€”å®šç¾©ã—ã¦ã‚ã’ã‚‹ã¨ä¾¿åˆ©ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€RRULEã«ãŠã‘ã‚‹UNTILã‚’æŠ½å‡ºã—ãŸã„å ´åˆã ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

```Go
package main

import (
	"fmt"
	"time"

	"github.com/teambition/rrule-go"
)

func GetUntil(startData time.Time, endData time.Time, rruleData *string, exdateData *string) (time.Time, error) {
	var rruleInstance string
	var err error
	timeSetter := startData.Format("20060102T150405Z")
	if rruleData == nil {
		return endTimeData, err
	}
	rruleInstance = fmt.Sprintf("DTSTART:%s\nRRULE:%s", timeSetter, *rruleData)
	if exdateData != nil {
		rruleInstance = fmt.Sprintf("%s\nEXDATE:%s", rruleInstance, *exdateData)
	}
	RRule, err := rrule.StrToRRuleSet(rruleInstance)
	if err != nil {
		return endData, err
	}
	Until := RRule.All()[len(RRule.All())-1]
	return Until, err
}
```

# å®Ÿéš›ã«ä½•ã‹ä½œã£ã¦ã¿ã‚ˆã†
ã›ã£ã‹ããªã®ã§ã€ç°¡å˜ãªå…·ä½“ä¾‹ã¨ã—ã¦äººé–“ã®ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã§ã‚‚ç®—å‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
RRULEã§å‘¨æœŸã¯ç°¡å˜ã«ç®—å‡ºã§ãã¾ã™ã­ã€‚

> 1. èº«ä½“(Physical)     23æ—¥å‘¨æœŸï¼šä½“åŠ›ãƒ»è€ä¹…åŠ›ãƒ»æŠµæŠ—åŠ›ãƒ»ã‚¹ã‚¿ãƒŸãƒŠãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»å‹‡æ°—ãªã©
> 2. æ„Ÿæƒ…(Sensitivity)  28æ—¥å‘¨æœŸï¼šæ„Ÿæƒ…ãƒ»æ°—åˆ†ãƒ»ç¥çµŒãƒ»ç›´æ„Ÿãƒ»ãƒ ãƒ¼ãƒ‰ãƒ»æ„Ÿå—æ€§ãƒ»åå°„åŠ›ãƒ»å‰µé€ åŠ›ãªã©
> 3. çŸ¥æ€§(Intellectual) 33æ—¥å‘¨æœŸï¼šçŸ¥åŠ›ãƒ»æ€è€ƒåŠ›ãƒ»è¨˜æ†¶åŠ›ãƒ»åˆ†æåŠ›ãƒ»åˆ¤æ–­åŠ›ãƒ»é›†ä¸­åŠ›ãƒ»æ§‹æˆåŠ›ãªã©

$$\sin(\frac{2 \pi t}{T})$$

å‡ºå…¸ï¼šã€Œãƒã‚¤ã‚ªãƒªã‚ºãƒ ã®è¨ˆç®—ã€CASIO 
https://keisan.casio.jp/exec/system/1231994137

`T`ã«é–¢ã—ã¦ã¯ãã‚Œãã‚Œã®å‘¨æœŸã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€`t`ã«é–¢ã—ã¦ã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€
$$t = baseday - birthday$$

ä»Šå›ã¯å®Ÿéš›ã«æ—¥ä»˜ã®å·®åˆ†ã‚’è¨ˆç®—ã™ã‚‹éš›ã«Unixtimeã‚’ä½¿ã„ã¾ã™ãŒã€
Golangã®æ¨™æº–ã®Unixtimeã¯ç§’ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€

$$24 \times 60 \times 60 = 86400$$

ã“ã®86400ã‚’æ¬¡ã®ã‚ˆã†ã«Unixtimeã‹ã‚‰å‰²ã£ã¦ã‚ã’ã‚‹ã¨è‰¯ã„ã§ã™ã€‚

```Go
t := float64(baseday.Unix()/86400 - birthday.Unix()/86400)
```

å®Ÿè£…ã™ã‚‹ã¨æ¬¡ã«ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```Go
package main

import (
	"fmt"
	"math"
	"time"

	"github.com/teambition/rrule-go"
)

func biorhythm(startData time.Time, count int32, t float64) {
	timeSetter := startData.Format("20060102T150405Z")
	rrulePhysical := fmt.Sprintf("DTSTART:%s\nFREQ=DAILY;INTERVAL=23;COUNT=%d", timeSetter, count)
	rruleSensitivity := fmt.Sprintf("DTSTART:%s\nFREQ=DAILY;INTERVAL=28;COUNT=%d", timeSetter, count)
	rruleIntellectual := fmt.Sprintf("DTSTART:%s\nFREQ=DAILY;INTERVAL=33;COUNT=%d", timeSetter, count)
	P, _ := rrule.StrToRRule(rrulePhysical)
	S, _ := rrule.StrToRRule(rruleSensitivity)
	I, _ := rrule.StrToRRule(rruleIntellectual)

	fmt.Printf("Physical:     ")
	fmt.Printf("sin(2Ï€t/T)=%f", math.Sin((t*2*math.Pi)/23))
	fmt.Println(P.All())

	fmt.Printf("Sensitivity:  ")
	fmt.Printf("sin(2Ï€t/T)=%f", math.Sin((t*2*math.Pi)/28))
	fmt.Println(S.All())

	fmt.Printf("Intellectual: ")
	fmt.Printf("sin(2Ï€t/T)=%f", math.Sin((t*2*math.Pi)/33))
	fmt.Println(I.All())
}

func main() {
	birthday := // ? = time.Timeå‹ã®èª•ç”Ÿæ—¥ã‚’ã‚»ãƒƒãƒˆ
	baseday :=  // ? = time.Timeå‹ã®åŸºæº–æ—¥ã‚’ã‚»ãƒƒãƒˆ
	fmt.Println(birthday,baseday)
	t := float64(baseday.Unix()/86400 - birthday.Unix()/86400)
	biorhythm(birthday, 10, t)
}
```

https://play.golang.org/p/VOQl20-x9Cc

playgroundã§ã¯è©¦ã—ã«
2020-11-07 23:00:00 +0000 UTC m=+346896000.000000001
2020-11-14 23:00:00 +0000 UTC m=+347500800.000000001
ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚

ã“ã®ã‚ˆã†ãªå½¢ã§RRULEã‚’ç”¨ã„ã‚‹ã¨ã€ã—ã£ã‹ã‚Šã¨è¨€èªåŒ–ã•ã‚Œã‚‹ã®ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªè¡¨ç¾ã§å‘¨æœŸã‚’ç®—å‡ºã§ãã¾ã™ã­ã€‚

# æœ€å¾Œã«
ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã«é–¢ã—ã¦ã¯çµ±è¨ˆå­¦çš„ã«æœ‰æ„ãªãƒ‡ãƒ¼ã‚¿ãŒå¾—ã‚‰ã‚Œã¦ã„ãªã„ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†ã­ç¬‘
ã§ã™ãŒã€ä»®èª¬ã§ã‚ã£ãŸã¨ã—ã¦ã‚‚ã€ã‚ˆãã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆã®ä¸–ç•Œã§ç™»å ´ã—ã¾ã™ã‚ˆã­ã€‚
Golangã«ãŠã‘ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã«é–¢ã—ã¦ã‚‚ãã¡ã‚“ã¨ç‰¹æ€§ã€ç”¨æ³•ã‚’çŸ¥ã£ãŸä¸Šã§ãã®ãƒ„ãƒ¼ãƒ«ã‚’ã©ã†ä½¿ã£ã¦ã„ãã‹ã¨ã„ã†ã®ã¯ä½¿ã„æ‰‹æ¬¡ç¬¬ã§ã™ã­ã€‚

å‚è€ƒ
ã€ŒInternet Calendaring and Scheduling Core Object Specificationã€ http://www.ietf.org/rfc/rfc2445.txt
ã€Œrrule-goã€https://github.com/teambition/rrule-go
ã€Œãƒã‚¤ã‚ªãƒªã‚ºãƒ ã€ https://ja.wikipedia.org/wiki/%E3%83%90%E3%82%A4%E3%82%AA%E3%83%AA%E3%82%BA%E3%83%A0
ã€Œãƒã‚¤ã‚ªãƒªã‚ºãƒ ã®è¨ˆç®—ã€https://keisan.casio.jp/exec/system/1231994137

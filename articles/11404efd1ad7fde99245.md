---
title: "Makefileã§Zennã®è¨˜äº‹ã‚’ç”Ÿæˆã€åŸ·ç­†ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ¥½ã«ã™ã‚‹"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [github,docker,vim,makefile]
published: false
---

# Makefileã§Zennã®è¨˜äº‹ã‚’ç”Ÿæˆã€åŸ·ç­†ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ¥½ã«ã™ã‚‹

ã“ã‚“ã«ã¡ã¯ã€å‰å›ã®è¨˜äº‹ã§Virtual-zennã¨åä»˜ã‘ãŸmakeã ã‘ã§è¨˜äº‹ã‚’è‡ªå‹•ç”Ÿæˆã—ã€åŸ·ç­†ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã§ãã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¤ã„ã¦è»½ãã”ç´¹ä»‹ã—ã¾ã—ãŸã€‚

https://zenn.dev/_kazuya/articles/7814d63a424a4363cd11

ä»Šå›ã¯ã€æŠ€è¡“çš„ãªè©±ã‚’ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# ã‚·ãƒ³ãƒ—ãƒ«ã«Makefileã‚’ä½¿ã£ã¦ã¿ã‚‹

ã¾ãšã€ä»¥å‰ã‹ã‚‰ç§ã¯localç’°å¢ƒã®ä¸­ã§zenn-cliã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸãŒã€nodeã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤åŠ´åŠ›ã‚’å‰Šæ¸›ã™ã‚‹ãŸã‚ã€Makefileã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚
ã“ã‚Œã¯ã¨ã¦ã‚‚å˜ç´”ã§æ‰‹è»½ã ã¨æ€ã„ã¾ã™ã€‚
åˆã‚ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã—ãŸã€‚

```bash:Makefile
.PHONY: main
main: editor

.PHONY: book
book: editor-book

.PHONY: ls
ls: check

.PHONY: upload
upload:
	git add $(shell pwd)/articles/ 
	git commit -m "MAKEFILE: auto upload articles" 
	git push origin HEAD

.PHONY: create
create:
	npx zenn new:article

.PHONY: check
check:
	npx zenn list:articles
	npx zenn list:books

.PHONY: create-book
create-book:  create-book

.PHONY: edit-book
edit-book: edit-book

.PHONY: create-book
create-book:
	npx zenn new:book

.PHONY: upload-book
upload-book:
	git add $(shell pwd)/books/ 
	git commit -m "VIRTUALZENN: auto upload books" 
	git push origin HEAD

.PHONY: editor
editor:
	open http://localhost:8001 
	npx zenn new:article ; npx zenn preview & ; vim articles

.PHONY: edit
edit:
	open http://localhost:8002 
	npx zenn preview & ; vim articles

.PHONY: editor-book
editor-book:
	open http://localhost:8003
	npx zenn new:book ; npx zenn preview & ; vim books

.PHONY: edit-book
edit-book:
	open http://localhost:8004 
	npx zenn preview & ; vim books
```

ã“ã®ã‚ˆã†ãªMakefileã‚’çš†ã•ã‚“ã®zenn-cliã®åŸ·ç­†ç’°å¢ƒã«ãã®ã¾ã¾è¨­ç½®ã—ã¦éŠã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

ã¨ã¦ã‚‚ç°¡å˜ã«è¤‡æ•°ã®å‡¦ç†ã‚’å˜ç´”åŒ–ã§ãã¾ã™ã€‚
ã“ã‚Œã‚‰ã®å‡¦ç†ã«ã‚ˆã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€`.PHONY`ã‚’ã¤ã‘ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

# ã€œDockerã‚’ç”¨ã„ãŸç’°å¢ƒæ§‹ç¯‰è‡ªå‹•åŒ–ç·¨ã€œ

## ä½¿ç”¨ã—ãŸOSã€ãƒ„ãƒ¼ãƒ«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§

### é–‹ç™ºç’°å¢ƒ

+ macOS BigSur
+ Docker
+ zsh

### ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒ

+ node
+ ZennEditor
+ python3
+ shellcheck
+ Grunt
+ vim

# ç’°å¢ƒæ§‹ç¯‰

ç’°å¢ƒæ§‹ç¯‰ã«ã¯Dockerã‚’ä½¿ã„ã¾ã™ã€
Dockerã¯ã€ã‚³ãƒ³ãƒ†ãƒŠä»®æƒ³åŒ–ã‚’ç”¨ã„ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºãƒ»é…ç½®ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚ã‚‹ã„ã¯ã‚ªãƒ¼ãƒ—ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹ã€‚ Dockerã¯ã‚³ãƒ³ãƒ†ãƒŠä»®æƒ³åŒ–ã‚’ç”¨ã„ãŸOSãƒ¬ãƒ™ãƒ«ã®ä»®æƒ³åŒ–ã«ã‚ˆã‚Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºãƒ»å®Ÿè¡Œç’°å¢ƒã‹ã‚‰éš”é›¢ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç´ æ—©ã„æä¾›ã‚’å¯èƒ½ã«ã™ã‚‹[^1]ã€‚

ã¨ã‚ã‚‹ã‚ˆã†ã«ã€åŸ·ç­†ç’°å¢ƒã‚’ç¶ºéº—ã«ä¿ã¤ã“ã¨ãŒã§ãã‚‹ã®ã§Dockerã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰ã¯è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
zenn-cliã¯ã¾ã ã¾ã ãƒ™ãƒ¼ã‚¿ç‰ˆãªã®ã§ã€ä»Šå¾Œã®ã“ã¨ã‚’è€ƒãˆã¦ã‚‚ã€ãƒ¡ãƒªãƒƒãƒˆã¯å¤§ãã„ã¨æ€ã„ã¾ã™ã€‚

# æµã‚Œ

+ Dockerfileã‚’è¨˜è¿°
+ dotfilesã‚’æº–å‚™ã™ã‚‹
+ Makefileã‚’è¨˜è¿°ã™ã‚‹

### Dockerfileã‚’è¨˜è¿°

```docker:Dockerfile
From node
ENV LANG="ja_JP.UTF-8" LANGUAGE="ja_JP:ja" LC_ALL="ja_JP.UTF-8"

WORKDIR /virtual-zenn

RUN apt-get update \
      && apt-get -y install \
        vim \
        python3-pip \
        zsh \
        shellcheck \
      && git init \
      && git remote add origin https://github.com/Iovesophy/virtual-zenn.git \
      && git pull origin master \
      && npm init --yes \
      && npm install -g grunt-cli \
      && npm install \
        grunt \
        grunt-zshlint \
        zenn-cli \
      && npx zenn init

WORKDIR /virtual-zenn/dotfiles

RUN pip3 install --upgrade pip \
      && pip3 install vim-vint \
      && npm install -g grunt-cli \
      && npm install \
        grunt \
        grunt-zshlint

RUN ./test.sh

WORKDIR /virtual-zenn
```

Dockerfileã§å„ç¨®ä½¿ç”¨ã—ãŸã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã‚’ã‚ã‚‰ã‹ã˜ã‚è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã¯zenn.devãŒæä¾›ã—ã¦ã„ã‚‹Zenn CLIãŒNode.jsè£½ãªã®ã§ã€nodeã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

Zenn CLIã®å°å…¥æ‰‹é †ã«é–¢ã—ã¦ã¯å…¬å¼ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://zenn.dev/zenn/articles/install-zenn-cli

ã¾ãŸã€virtual-zennã¨ã„ã†åå‰ã§ä»Šå›ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç­‰ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://github.com/Iovesophy/virtual-zenn

```
ENV LANG="ja_JP.UTF-8" LANGUAGE="ja_JP:ja" LC_ALL="ja_JP.UTF-8"
```

ã“ã®è¨­å®šã¯vimã‚’é–‹ã„ãŸæ™‚ã«æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã™ã‚‹ã®ã‚’é˜²ããŸã‚ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```
        shellcheck \
```

ã“ã®shellcheckã¯shellscriptã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹ãŸã‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚
ã¨ã¦ã‚‚ã„ã„ãƒ„ãƒ¼ãƒ«ãªã®ã§ç´¹ä»‹ã—ã¦ãŠãã¾ã™ã€‚
æ¬¡ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
https://github.com/koalaman/shellcheck

```
      && npm install -g grunt-cli \
      && npm install \
        grunt \
        grunt-zshlint \
```

ã“ã®éƒ¨åˆ†ã¯Gruntã‚’ä½¿ã£ã¦zshç­‰ã®dotfilesãŒãã¡ã‚“ã¨è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
Gruntã‚’ä½¿ã£ãŸ.zshrcã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã«é–¢ã—ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://github.com/pine/grunt-zshlint


### dotfilesã‚’è¨­å®šã™ã‚‹

ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã®ã‚·ã‚§ãƒ«ã‚’ä½¿ã†ã“ã¨ã‚‚æƒ³å®šã—ã¦ã€å„ç¨®å¿…è¦ãªdotfilesã‚‚è¨­å®šã—ã¾ã™ã€‚
dotfilesã®æœ€ä½é™ã®è¨­å®šç­‰ã‚’è‡ªå‹•ã§è¨­å®šã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ä»¥å‰æ›¸ã„ãŸã®ã§ãã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ã“ã‚Œã¯ã€å¥½ã¿ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ãã‚Œãã‚Œå®Ÿç¾ã—ãŸã„ç’°å¢ƒã«ã‚ˆã£ã¦æ§‹ç¯‰ã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

å‚è€ƒã¾ã§ã«dotfilesã®è‡ªå‹•è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç½®ã„ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚
https://github.com/Iovesophy/dotfiles

### Makefileã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ç­‰ã‚’æ¥½ã«ã™ã‚‹

æœ€å¾Œã«Makefileã‚’å®šç¾©ã—ã¦ã€ç’°å¢ƒæ§‹ç¯‰ã«å¿…è¦ãªdockerã®ã‚³ãƒãƒ³ãƒ‰ã‚„nodeã®ã‚³ãƒãƒ³ãƒ‰ç­‰ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¾ã™ã€‚

```bash:Makefile
NAME := virtual-zenn

.PHONY: main
main: docker-build docker-run-vim

.PHONY: book
book: docker-build docker-run-vim-book

.PHONY: create
create: docker-build docker-run-create

.PHONY: edit
edit: docker-build docker-run-edit

.PHONY: ls
ls: docker-build docker-run-check

.PHONY: reset
reset: docker-run-rm

.PHONY: update
update:
	git pull origin master

.PHONY: upload
upload:
	mv $(shell pwd)/articles/stage/* $(shell pwd)/articles/ ; git add $(shell pwd)/articles/ ; git commit -m "VIRTUALZENN: auto upload articles" ; git push origin HEAD

.PHONY: docker-build
docker-build:
	docker build -t $(NAME) .

.PHONY: docker-run-rm
docker-run-rm:
	docker run --rm $(NAME)

.PHONY: docker-run-create
docker-run-create:
	docker run -v $(shell pwd)/articles/stage:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn new:article"

.PHONY: docker-run-check
docker-run-check:
	docker run -v $(shell pwd)/articles:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn list:articles"
	docker run -v $(shell pwd)/articles/stage:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn list:articles"
	docker run -v $(shell pwd)/articles:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn list:books"
	docker run -v $(shell pwd)/articles/stage:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn list:books"


.PHONY: create-book
create-book: docker-build docker-run-create-book

.PHONY: edit-book
edit-book: docker-build docker-run-edit-book

.PHONY: docker-run-create-book
docker-run-create-book:
	docker run -v $(shell pwd)/books/stage:/virtual-zenn/books -it $(NAME) zsh -c "npx zenn new:book"

.PHONY: upload-book
upload-book:
	mv $(shell pwd)/books/stage/* $(shell pwd)/books/ ; git add $(shell pwd)/books/ ; git commit -m "VIRTUALZENN: auto upload books" ; git push origin HEAD

.PHONY: docker-run-vim
docker-run-vim:
	open http://localhost:8001 ; docker run -p 8001:8000 -v $(shell pwd)/articles/stage:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn new:article ; npx zenn preview & ; vim articles"

.PHONY: docker-run-edit
docker-run-edit:
	open http://localhost:8002 ; docker run -p 8002:8000 -v $(shell pwd)/articles/stage:/virtual-zenn/articles -it $(NAME) zsh -c "npx zenn preview & ; vim articles"

.PHONY: docker-run-vim-book
docker-run-vim-book:
	open http://localhost:8003 ; docker run -p 8003:8000 -v $(shell pwd)/books/stage:/virtual-zenn/books -it $(NAME) zsh -c "npx zenn new:book ; npx zenn preview & ; vim books"

.PHONY: docker-run-edit-book
docker-run-edit-book:
	open http://localhost:8004 ; docker run -p 8004:8000 -v $(shell pwd)/books/stage:/virtual-zenn/books -it $(NAME) zsh -c "npx zenn preview & ; vim books"
```

ç§ã¯ã‚ˆãvimã‚’ä½¿ã†ã®ã§makeã‚’ã™ã‚‹ã¨ç’°å¢ƒæ§‹ç¯‰ãŒå§‹ã¾ã‚Šã€zenn-cliã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€zennã®è¨˜äº‹ã‚’è‡ªå‹•ç”Ÿæˆã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èµ·å‹•ã€vimã‚’ç«‹ã¡ä¸Šã’ã‚‹ã€ã¨ã„ã†æµã‚Œã§è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ã€‚

vimã§ã¯ãªãã¦ã€ãŠæ°—ã«å…¥ã‚Šã®ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’ä½¿ã†å ´åˆã‚‚åŸºæœ¬çš„ãªæµã‚Œã¯åŒã˜ãªã®ã§ã€openç­‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚„ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ã‚³ãƒãƒ³ãƒ‰ç­‰ã§è‡ªå‹•åŒ–ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

zenn-cliã¯ãƒŠãƒ¬ãƒƒã‚¸ã‚’è²¯ã‚ã‚‹ã“ã¨ãã®ã‚‚ã®ã‚’ã‹ã£ã“ã‚ˆãã—ã¦ãã‚Œã¦ã€ãƒ¦ãƒ¼ã‚¶ã®è‡ªç”±åº¦ãŒé«˜ã„ã€å¯èƒ½æ€§ã®ç§˜ã‚ãŸãƒ„ãƒ¼ãƒ«ã ã¨æ€ã„ã¾ã™ã€‚

ã©ã®ã‚ˆã†ã«ãƒŠãƒ¬ãƒƒã‚¸ã‚’è²¯ã‚ã¦è¡Œãã‹ã€ã¨ã„ã†ã“ã¨ã«ã¯ã“ã‚Œã‹ã‚‰ã‚‚ã“ã ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã€ä»Šå›ã®virtual-zennã«é–¢ã—ã¦ã‚‚å°‘ã—ãšã¤æ”¹å–„ã‚’ç¶šã‘ã¦è¡ŒããŸã„ã¨æ€ã„ã¾ã™ã€‚

### æœ€å¾Œã«

ä»Šå›ã®virtual-zennã¯ç§ã®åŸ·ç­†ç’°å¢ƒã®ä¸€ä¾‹ã§ã™ã€ã“ã‚ŒãŒæ­£è§£ã§ã‚‚ãªã„ã—ã€ç¾çŠ¶ã«æº€è¶³ã—ã¦ã¯ãªã‚‰ãªã„ã¨ç§è‡ªèº«æ€ã£ã¦ãŠã‚Šã¾ã™ã€‚
ã“ã‚Œã‹ã‚‰ã‚‚Zennã¨ã¨ã‚‚ã«è‡ªã‚‰ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ã‚ã‚Šæ–¹ã‚’è€ƒãˆç¶šã‘ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚
ä¸€å¿œã€ä»Šå›ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç­‰ã¯virtual-zennã¨ã—ã¦MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€ãƒ•ã‚©ãƒ¼ã‚¯ç­‰è‡ªç”±ã«ã—ã¦ã„ãŸã ã„ã¦æ§‹ã„ã¾ã›ã‚“ã€‚

ã“ã†ã—ãŸæ–¹ãŒã‚‚ã£ã¨ã‹ã£ã“ã„ã„ã¨ã‹ã€ã“ã‚Œã¯ãƒŠãƒ³ã‚»ãƒ³ã‚¹ã ç­‰ã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆç­‰ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

### ãŠã¾ã‘

å‰å›ä½¿ç”¨æ–¹æ³•ã«é–¢ã—ã¦ã®è¨˜äº‹ã‚’ã‚ã’ãŸå¾Œã«shellcheckã‚¨ãƒ©ãƒ¼ãŒã§ã¦ä½¿ç”¨ã§ããªã„ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚
ã“ã®çµŒé¨“ã‚’è¸ã¾ãˆã¦CI/CDã‚’å°å…¥ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯GitHub Actionsã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
æ¬¡ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
 virtual-zenn
 â””â”€.github
    â””â”€â”€ workflows
        â””â”€â”€ docker.yml
```

yamlãƒ•ã‚¡ã‚¤ãƒ«ã§å®Ÿè¡Œã—ãŸã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨˜è¿°ã—ã¾ã™ã€‚
ä»Šå›ã¯æ¯æ—¥ä¸€å›ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚

```yaml:docker.yml
name: CI to Docker Hub
on:
    schedule:
        - cron:  '30 14 * * *' # 23 o'clock,30 min everyday

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Check Out Repo
              uses: actions/checkout@v2
            - name: Login to Docker Hub
              uses: docker/login-action@v1
              with:
                  username: ${{ secrets.DOCKER_HUB_USERNAME }}
                  password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
            - name: Set up Docker Buildx
              id: buildx
              uses: docker/setup-buildx-action@v1
            - name: Build and push
              id: docker_build
              uses: docker/build-push-action@v2
              with:
                    context: ./
                    file: ./Dockerfile
                    push: true
                    tags: ${{ secrets.DOCKER_HUB_USERNAME }}/simplewhale:latest
            - name: Image digest
              run: echo ${{ steps.docker_build.outputs.digest }}

            - name: Line Notify on Failure
              uses: snow-actions/line-notify@v1.0.0
              if: failure()
              with:
                access_token: ${{ secrets.LINE_KEY_NAME }}
                message: virtual-zenn failed build

```

ã“ã®secretsã¯Githubã‚„Dockerhubä¸Šã§ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚
ã¾ãšã€Docker Hubã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

https://hub.docker.com/

ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒã§ããŸã‚‰ã€æ¬¡ã«å³ä¸Šã«ã‚ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã€ä»¥ä¸‹ã®é …ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/qjssrgpbrr8fxcyi4eliuhyt1sr9)

æ¬¡ã«ã€Securityâ†’New Access Tokenã®é †ã«ã‚¯ãƒªãƒƒã‚¯ã€‚

![](https://storage.googleapis.com/zenn-user-upload/nso8p6lzjcn83l1rk9y65hhr6kpx)

TokenãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€é©å½“ã«titleãªã©ã‚’å…¥åŠ›ã—ã€Copyã—ã¦ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4fyfvf8oohf87br3s9vmcthkn9vr)

æ¬¡ã«Githubã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

https://github.com/

Settingâ†’Secretâ†’New repository secretã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã‚Œãã‚Œå…ˆç¨‹ã®Tokenã‚„Docker Hubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¨­å®šã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e29rz8p6j5c9254ayvvlyndyox7s)
![](https://storage.googleapis.com/zenn-user-upload/214pnbq0ffx12tyymyn9jcmal0aw)

buildãŒå¤±æ•—ã—ãŸã‚‰LINEã«é€šçŸ¥ã‚’ã—ã¾ã™ã€‚@SnowCaitã•ã‚“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€ä¾¿åˆ©ã§ã™ã€‚
LINEã«é€šçŸ¥ã™ã‚‹æ–¹æ³•ã¯æ¬¡ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://qiita.com/SnowCait/items/fa38222b616e56be1a84
https://github.com/snow-actions/line-notify

ä»¥ä¸Šã§è¨­å®šã¯å®Œäº†ã§ã™ã€‚
ã“ã‚Œã§æ¯æ—¥è‡ªå‹•ã§ActionãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

[^1]: ã€ŒDockerã€ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ https://ja.wikipedia.org/wiki/Docker


---
title: "Golang ã§ YAML ã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹"
emoji: "ğŸ—"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go,YAML]
published: true
---
# Golang ã§ YAML ã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹

ã“ã‚“ã«ã¡ã¯ã€æœ€è¿‘ YAML ã‚’ãªã‚“ã¨ãªãè§¦ã£ã¦ã„ãŸã®ã§ã™ãŒã€ã„ã¾ã„ã¡ç†è§£ã—ã¦ã„ãªã„éƒ¨åˆ†ã‚‚ã‚ã‚Šã€ã¾ãŸ IaC ã®å‹‰å¼·ã‚’å§‹ã‚ã¦ã¿ãŸã‚Šã€ Golang ã§ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒå‡ºã¦ããŸã‚Šã¨ã€ä»Šå¾Œã®ã“ã¨ã‚’è€ƒãˆã¦ã“ã“ã§è§£èª¬ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã—ãŸã€‚

# YAMLã«ã¤ã„ã¦
YAML Ain't Markup Language (YAML) ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºè¨€èªã€
YAML ã¯ã“ã®æ•°å¹´ã§ç€å®Ÿã«é€²åŒ–ã—ã¦ãŠã‚Šã€ã‚ã‚Šã¨äººæ°—ãŒå‡ºã¦ãã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

YAML ã®ãƒ¡ãƒªãƒƒãƒˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã§ããŸã‚Šã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã§åŒºåˆ‡ã£ã¦ã„ã‚‹ç‚¹ãªã©ã€ä½•ã‚ˆã‚Šäººé–“ã«ã¨ã£ã¦èª­ã¿ã‚„ã™ã„ã¨ã„ã†ã®ãŒå¤§ããªãƒ¡ãƒªãƒƒãƒˆã ã¨æ€ã„ã¾ã™ã€‚

YAML ã¯ä¸»ã«ä½•ã«ä½¿ã‚ã‚Œã‚‹ã‹ã¨ã„ã†ã¨ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚
ã“ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹è¨€èªã®èƒ½åŠ›ã«é–¢ã—ã¦ JSON ã®ã‚ˆã†ãªè¨€èªã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ˆãè¦‹ã‚‰ã‚Œã¦ã¾ã™ã€‚

ä»Šå›ã¯YAMLã®æ–‡æ³•ã‚’ Golang ã§ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ãªãŒã‚‰è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§ YAML ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†

ã¾ãšãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®å‰ã«é©å½“ã« YAML ã§ã‚µãƒ³ãƒ—ãƒ«ã‚’æ›¸ã„ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```yaml
 hoge: "hogehoge"
 gaga: 'gagagaga'
 huga: hugahuga
 life: 788400.5
 birthday: true
 count: 3
 calling-item:
   - hoge
   - gaga
   - huga
 day-01:
   calling-item: three
   action:
     sleep: 7
     move: 3
     eat: 0.5
```

# YAML ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿å‹

YAML ã«ã¯ä¸»ã«ï¼”ã¤ã®ãƒ‡ãƒ¼ã‚¿å‹ãŒã‚ã‚Šã¾ã™ã€‚

- strings
- integer
- floating-point number
- boolean

ã¾ãšå…ˆé ­ã® `hoge` , `gaga` , `huga`ã€€ã¯é©å½“ã«å‘½åã—ã¦ã„ã¾ã™ãŒã€ã„ãšã‚Œã‚‚ strings ã§ã™ã€‚
YAML ã§ã¯å¼•ç”¨ç¬¦ã«ã‚ˆã‚‹åŒºåˆ¥ã¯ãªã„ã®ã§ã€ã“ã®ç‚¹ã«é–¢ã—ã¦ã¯ã€åŸºæœ¬çš„ã«è‡ªç”±ã«è¨˜è¿°ã§ãã¾ã™ãŒã€å¼•ç”¨ç¬¦ã®ãªã„æ•°å­—ã¯ä¾‹å¤–ã§ã™ã€‚
ã¤ã¾ã‚Šã€å¼•ç”¨ç¬¦ã§å›²ã¾ã‚Œã¦ã„ãªã„æ•°å€¤ã‚’æ•´æ•°ã¾ãŸã¯æµ®å‹•å°æ•°ç‚¹ã¨ã—ã¦èªè­˜ã—ã¾ã™ã€‚

```yaml 
calling-item:
   - hoge
   - gaga
   - huga
```

ã“ã®è¨˜è¿°æ–¹æ³•ã¯é…åˆ—ã§ã™ã€‚
`calling-item` ã«ã¯4ã¤ã®è¦ç´ ãŒã‚ã‚Šã€ãã‚Œãã‚Œã®è¦ç´ ã‚’ãƒã‚¤ãƒ•ãƒ³ã§è¡¨ã—ã¾ã™ã€‚
ãã‚Œã‹ã‚‰ã€2ã¤ã®ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã¯ã€ YAML ãŒãƒã‚¹ãƒˆã‚’ç¤ºã™æ–¹æ³•ã€‚

ã‚¹ãƒšãƒ¼ã‚¹ã®æ•°ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ãŒã€ã‚¿ãƒ–ã¯ä½¿ç”¨ã§ããªã„ã§ã™ã€‚

```yaml
 day-01:
   calling-item: three
   action:
     sleep: 7
     move: 3
     eat: 0.5
```

æœ€å¾Œã«ã€`day-01` ãŒã‚ã‚Šã¾ã™ã€‚ `day-01` ã«ã¯ã•ã‚‰ã«è¦ç´ ãŒã‚ã‚Šã€ãã‚Œãã‚ŒãŒã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

`day-01` ã¯ã€1ã¤ã®æ–‡å­—åˆ—ã€ãŠã‚ˆã³åˆ¥ã®è¦ç´ ã‚’å«ã‚€è¦ç´ ã¨ã—ã¦è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

YAML ã¯ã‚­ãƒ¼å€¤ã®ãƒã‚¹ãƒˆã¨å‹ã®æ··åˆå®šç¾©ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚


æ¬¡ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„ã‚ˆã†ã« json ã«ç½®ãæ›ãˆã¦ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ã“ã®ã‚ˆã†ã«ãƒã‚¹ãƒˆã•ã‚ŒãŸéƒ¨åˆ†ã‚‚{}ã§æ‹¬ã£ã¦ãã‚Œã‚‹ã®ã§ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã—ã‚„ã™ã„ã§ã™ãŒã€æ™‚ã«èª­ã¿ã¥ã‚‰ã„ã¨æ€ã†ã®ã§ã€ YAML ã®æ–‡æ³•ã‚’çŸ¥ã£ã¦ã„ã‚Œã° YAML ã®æ–¹ãŒå¯èª­æ€§ãŒä¸ŠãŒã‚Šã¾ã™ã­ã€‚

```json
{
  "hoge": "hogehoge",
  "gaga": 'gagaga',
  "huga": hugahuga,
  "life": 788400.5,
  "birthday": true,
  "count": 3,
  "calling-item": [
     "hoge",
     "gaga",
     "huga",
  ],
  "day-01": {
  "calling-item": "three",
    "action": {
      "sleep": 3,
      "move": 5,
      "eat": 0.5
    }
  }
}
```

# ãã‚Œãã‚Œã®å‹ã‚’ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¦ã¿ã‚‹

Golang ã§ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹å­˜åœ¨ã—ã¾ã™ãŒã€ä»Šå›ã¯ `go-yaml` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ãƒ‡ã‚·ãƒªã‚¢ã‚¤ã‚ºã‚’ã‚„ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://github.com/go-yaml/yaml

ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ä¸Šã§å°‘ã—ã‚ã‹ã‚Šã«ãã„äºˆç´„èªãŒã‚ã‚‹â†’ï¼ˆ Marshal , Unmarshal ï¼‰

+ Marshal æ•´åˆ—ã•ã›ã‚‹ã€æ•´ç†ã™ã‚‹
+ Unmarshal ç„¡ç§©åºãªçŠ¶æ…‹ã«ã™ã‚‹

ãªã®ã§ã€ parse ã‚„ mapping ç­‰ã‚ã‹ã‚Šã‚„ã™ã„é–¢æ•°åã«ã—ã¦ä¸€é€£ã® Marshal , Unmarshal ã®å‡¦ç†ã‚’ã¾ã¨ã‚ã‚‹ã¨ãã£ã¨ã‚ã‹ã‚Šã‚„ã™ãã€ç›´æ„Ÿçš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ“ä½œã§ãã‚‹ã ã‚ã†ã€‚

# ä¸€é€£ã®å‡¦ç†ã‚’å…±é€šé–¢æ•°ã«ã—ã¦ã¿ã‚‹ã€‚

Marshal , Unmarshal ã‚’ç†è§£ã—ã¦ä½¿ã„ã“ãªã™ã«ã¯è‰²ã€…ã¨æ‰‹ç¶šãã‚’è¸ã¾ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã§ã€é¢å€’ã§ã‚ã‚‹ã€‚
ãªã®ã§æ§˜ã€…ãªå‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’Golangã®æ§‹é€ ä½“ã®å„ç¨®å‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« Marshal , Unmarsha ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ã¾ã¨ã‚ã¦ãŠãã¨ä½¿ã„å‹æ‰‹ãŒè‰¯ã„ã€‚

ã¾ãŸã€ãƒ‘ãƒ¼ã‚¹ã—ãŸã®ã¡ã«å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æŠ½å‡ºã—ãŸã„å ´åˆãŒã‚ã‚‹ã¨æ€ã†ãŒã€å˜ç´”ã«æŠ½å‡ºã—ãŸã„å ´åˆãŒã‚ã‚‹ã¨æ€ã†ãŒã€ãã®éš›ã«ã‚‚ä¸€é€£ã® Marshal , Unmarshal å‡¦ç†ã‚‚é–¢æ•°åŒ–ã—ã¦ãŠãã¨éå¸¸ã«ä¾¿åˆ©ã§ã‚ã‚‹ã€‚

https://play.golang.org/p/7iV_1fhrFWb

```Go
package main

import (
	"errors"
	"fmt"
	"log"
	"reflect"

	"gopkg.in/yaml.v2"
)

var data = `
a: test
b: 6
`

func parse(data string, dest interface{}) error {
	if reflect.TypeOf(dest).Kind() != reflect.Ptr {
		return errors.New("mapping: dest is not pointer")
	}
	parseError := yaml.Unmarshal([]byte(data), dest)
	return parseError
}

func mapping(source interface{}, copy interface{}) error {
	data, sourceError := yaml.Marshal(source)
	if sourceError != nil {
		return sourceError
	}
	if reflect.TypeOf(copy).Kind() != reflect.Ptr {
		return errors.New("mapping: copy is not pointer")
	}
	destError := yaml.Unmarshal(data, copy)
	return destError
}

func main() {
	var schema struct {
		A string
		B int
	}
	var copy struct {
		A string
	}
	if err := parse(data, &schema); err != nil {
		log.Fatalf("error: %v", err)
	}
	if err := mapping(&schema, &copy); err != nil {
		log.Fatalf("error: %v", err)
	}
	fmt.Println(schema)
	fmt.Println(copy)
}
```

æœ€å¾Œã«æ§˜ã€…ãªå‹ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦å¿…è¦ãªæ§‹é€ ä½“ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡ºã—ã¦ã¿ã‚ˆã†ã€‚

https://play.golang.org/p/FeYu9_Cfl9l

```Go
ackage main

import (
	"errors"
	"fmt"
	"log"
	"reflect"

	"gopkg.in/yaml.v2"
)

var data = `
a: test
b: 0
c: true
d: 3.14
e: 00
f:
   - hoge
   - huga
g:
   - 0
   - 1
   - 2
`

func parse(source string, dest interface{}) error {
	if reflect.TypeOf(dest).Kind() != reflect.Ptr {
		return errors.New("mapping: dest is not pointer")
	}
	parseError := yaml.Unmarshal([]byte(source), dest)
	return parseError
}

func mapping(source interface{}, dest interface{}) error {
	data, sourceError := yaml.Marshal(source)
	if sourceError != nil {
		return sourceError
	}
	if reflect.TypeOf(dest).Kind() != reflect.Ptr {
		return errors.New("mapping: dest is not pointer")
	}
	destError := yaml.Unmarshal(data, dest)
	return destError
}

func main() {
	var schema struct {
		A string
		B int
		C bool
		D float32
		E byte
		F []string
		G []int
	}
	var copy struct {
		A string
		F []string
	}
	if err := parse(data, &schema); err != nil {
		log.Fatalf("error: %v", err)
	}
	if err := mapping(schema, &copy); err != nil {
		log.Fatalf("error: %v", err)
	}
	fmt.Println(schema)
	fmt.Println(copy)
}
```

çµæœã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

```Go
{test 0 true 3.14 0 [hoge huga] [0 1 2]}
{test [hoge huga]}
```

æœ¬æ¥ã® YAML ã‹ã‚‰ Unmarshal ã—ãŸæ§‹é€ ä½“ã€

```Go
var schema struct {
		A string
		B int
		C bool
		D float32
		E byte
		F []string
		G []int
	}
```

ã‹ã‚‰ã€å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã£ãŸæ§‹é€ ä½“ã€Œ copy ã€ã«ä¸€æ—¦ YAML ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¦ã‹ã‚‰ã€Œ copy ã€ã¸ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

https://play.golang.org/p/i9LLyoQt_h2

(â†‘ YAML ã¸ã®ä¸€æ™‚çš„ãªã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®æ§˜å­)

# ã¾ã¨ã‚

go-yaml ã‚’ä½¿ãˆã°ã€ YAML ã‚’ç‰¹ã«é›£ã—ã„ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãã‚ã‚‹ç¨‹åº¦è‡ªç”±ã«æ“ä½œã§ãã¾ã™ã­ã€‚

ã¾ãŸåŒæ§˜ã« JSON ã«é–¢ã—ã¦ã‚‚ã“ã®ã‚ˆã†ãªæ„Ÿã˜ã§`encoding/json`ã‚’ç”¨ã„ã¦ Marshal , Unmarshal ã§ãã¾ã™ã€‚

Webé–‹ç™ºã§ã¯ã‚ˆããƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ JSON å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ãŒå¤šã„ã¨æ€ã†ã®ã§ JSON ã® Marshal , Unmarshal æ“ä½œã‚‚åŒæ§˜ã«è¦šãˆã¦ãŠãã¨è‰¯ã•ãã†ã§ã™ã€‚

ã“ã“ã¾ã§ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

## å‚è€ƒ

ã€Œyaml-tutorialã€ https://www.cloudbees.com/blog/yaml-tutorial-everything-you-need-get-started

ã€Œgo-yaml/yamlã€ https://github.com/go-yaml/yaml

ã€Œgolang/goã€ã€€https://github.com/golang/go/blob/master/src/encoding/json/encode.go

ã€Œjsonã€ã€€https://pkg.go.dev/encoding/json


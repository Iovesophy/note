---
title: "è¶…ç´°åˆ†åŒ– CloudFormation ã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
emoji: "ğŸ“¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [AWS,CloudFormation,S3]
published: true
---
# è¶…ç´°åˆ†åŒ– AWS CloudFormation RootStackTemplate

```bash
AWSTemplateFormatVersion: 2010-09-09
 _____                 _     _____  _                 _
|  __ \               | |   / ____|| |               | |
| |__) |  ___    ___  | |_ | (___  | |_   __ _   ___ | | __
|  _  /  / _ \  / _ \ | __| \___ \ | __| / _` | / __|| |/ /
| | \ \ | (_) || (_) || |_  ____) || |_ | (_| || (__ |   <
|_|  \_\ \___/  \___/  \__||_____/  \__| \__,_| \___||_|\_\
```

## ã‚ã‚‰ã¾ã—

ã“ã‚“ã«ã¡ã¯ã€å…ˆæœˆSAAã«åˆæ ¼ã—ãŸã®ã§ã™ãŒã€ã©ã†ã‚‚æœºä¸Šã®ç©ºè«–ã§çµ‚ã‚ã£ã¦ã„ã‚‹æ°—ãŒã—ãŸã®ã§ã€å¾©ç¿’ã‚‚å…¼ã­ã¦å®Ÿéš›ã«CloudFormationã‚’ã‚‚ã£ã¨å®Ÿè·µçš„ã«è¨˜è¿°ã—ã¦ã„ã“ã†ã¨è‰²ã€…ã‚„ã£ã¦ã¿ã¦ã„ã¾ã™ã€‚

https://www.credly.com/badges/a9a52cc4-9106-4c48-b434-84cc4adaaa56

ä»Šå›ã¯CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚‚ã£ã¨æŸ”è»Ÿã«ä½¿ã„ã¾ã‚ã›ã‚‹ã‚ˆã†ã«ã€è¶…ç´°åˆ†åŒ–ã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹ã”ã¨ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ†ã‘ã¦ã€ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ§‹æˆã—ã¦ã¿ã¾ã—ãŸã€‚

## ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- AWS
- CloudFormation
- S3
- ãƒ«ãƒ¼ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- ã‚¯ãƒ­ã‚¹ã‚¹ã‚¿ãƒƒã‚¯å‚ç…§
- Outputsã‚»ã‚¯ã‚·ãƒ§ãƒ³
- ImportValueé–¢æ•°
- GetAtté–¢æ•°

> AWS CloudFormationã¨ã¯ï¼Ÿ

> ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚ã‚‰ã‚†ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ã¨ã•ã‚Œã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
CloudFormationã«é–¢ã™ã‚‹è¿½åŠ æ–™é‡‘ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚ï¼ˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸAWSãƒªã‚½ãƒ¼ã‚¹åˆ†ã®æ–™é‡‘ã®ã¿ç™ºç”Ÿã—ã¾ã™ã€‚ï¼‰

https://ecs-for-aws-summit-online.workshop.aws/1_setup/11_cloudformation.html

ä»Šå›ã®åŸºæœ¬æ§‹æˆæ–¹é‡å›³

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-08-31 0.59.20.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1009976/d3ca1fd4-f1be-a854-6384-dcd6f0e506fd.png)

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-08-31 1.10.11.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1009976/ff7ca00e-aebc-06a8-fdf6-c5175ad6e334.png)


- ãƒãƒ«ãƒAZæ§‹æˆï¼ˆãƒˆãƒªãƒ—ãƒ«AZï¼‰
- ELBã«ã‚ˆã‚‹è² è·åˆ†æ•£

# VPC
ã¾ãšã¯VPCã§ã™ã€
è¶…ç´°åˆ†åŒ–ã™ã‚‹éš›ã«åŸºæº–ã«ã—ãŸã®ã¯ä¸€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ãŠã„ã¦æ¥µåŠ›ä¸€ãƒªã‚½ãƒ¼ã‚¹ã¾ã§ã‚’å‡ºåŠ›ã™ã‚‹ã¨è¨€ã†ã“ã¨ã‚’æ„è­˜ã—ã¾ã—ãŸã€‚

ã¾ãŸç´°åˆ†åŒ–ã™ã‚‹ã«ã‚ãŸã£ã¦å·¥å¤«ã—ãŸç‚¹ã¯ã€
CloudFormationã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã¨ã€ç´°åˆ†åŒ–ã—ãŸéš›ã«Outputsã‚’ã„ã¡ã„ã¡ç¢ºèªã—ãŸã‚Šæ¢ã—ãŸã‚Šã™ã‚‹ã®ã«è‹¦åŠ´ã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ç‰¹ã«ä»Šå›ã®ã‚ˆã†ã«è¶…ç´°åˆ†åŒ–ã—ã¦CloudFormationTemplateã‚’è¨˜è¿°ã™ã‚‹ã¨ãªã‚‹ã¨ã€ã™ãã«è¦‹ã‚‹ã¹ããƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹å¤±ã„ãŒã¡ã§ã™ã€‚

YAMLã§è¨˜è¿°ã™ã‚‹ã¨JSONã¨é•ã£ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã§ãã‚‹ã®ã§ã€ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã‚³ãƒ¡ãƒ³ãƒˆã§çœ‹æ¿çš„ãªã‚‚ã®ã‚’è¨˜è¿°ã—ã¦ã‚ã‚Šã¾ã™ã€‚ãƒ€ãƒ©ãƒ€ãƒ©ã¨Descriptionã‚’è¨˜è¿°ã™ã‚‹ã‚ˆã‚Šã¯è¦–èªæ€§ãŒä¸ŠãŒã£ã¦å€‹äººçš„ã«ã¯ã„ã„ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ°—ã«å…¥ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚“ãªæ„Ÿã˜â†“

```bash
 __      __
 \ \    / /
  \ \  / /  _ __    ___
   \ \/ /  | '_ \  / __|
    \  /   | |_) || (__
     \/    | .__/  \___|
           | |
           |_|
```

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-08-13 15.16.52.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1009976/117d0d96-f1b8-0c92-4f73-81aaed4ceecd.png)

ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã¯æ¬¡ã®Webã‚µãƒ¼ãƒ“ã‚¹ã§ç”Ÿæˆã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://rakko.tools/tools/68/

ã§ã¯ã€ä¸€è¡Œç›®ã‹ã‚‰é †ã«ã¿ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```
AWSTemplateFormatVersion: 2010-09-09
```
ã“ã®å®£è¨€ã«é–¢ã—ã¦ã¯CloundFormationã‚’è¨˜è¿°ã™ã‚‹ä¸Šã§ã€ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè¡Œã•ã›ã‚‹ã‹ã¨è¨€ã†ã“ã¨ã‚’å®£è¨€ã§ãã¾ã™ã€‚

> æœ€æ–°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å½¢å¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 2010-09-09 ã§ã‚ã‚Šã€ç¾æ™‚ç‚¹ã§å”¯ä¸€ã®æœ‰åŠ¹ãªå€¤ã§ã™ã€‚

AWSTemplateFormatVersion ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ä»»æ„è¨˜è¼‰ã§ã™ã€‚

https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/format-version-structure.html

`Resources:`ä»¥ä¸‹ã«ã¯AWSã«ãŠã‘ã‚‹å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹å®šç¾©ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ã§ã¯VPCã®Templateã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```yml
AWSTemplateFormatVersion: 2010-09-09
# __      __
# \ \    / /
#  \ \  / /  _ __    ___
#   \ \/ /  | '_ \  / __|
#    \  /   | |_) || (__
#     \/    | .__/  \___|
#           | |
#           |_|
Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
      - Key: Name
        Value: cfn-training-vpc
Outputs:
  VpcOut:
    Value: !Ref VPC
    Export:
      Name: CreateVpc
```

ä»Šå›ã¯YAMLã§è¨˜è¿°ã™ã‚‹ã®ã§ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã«æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€æ–‡å­—åˆ—å‹ã®è¨˜è¿°ã«é–¢ã—ã¦YAMLã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚¦ã‚©ãƒ¼ãƒˆã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚¦ã‚©ãƒ¼ãƒˆã€æ–‡å­—åˆ—ã‚’åŒºåˆ¥ã—ãªã„ã®ã§ã€ä»¥ä¸‹ã®å®£è¨€ã¯å…¨ã¦åŒã˜æ„å‘³ã¨ã—ã¦è§£é‡ˆã•ã‚Œã¾ã™ã€‚

```yml
AWSTemplateFormatVersion: "2010-09-09"
AWSTemplateFormatVersion: '2010-09-09'
AWSTemplateFormatVersion: 2010-09-09
```

`VPC:`ã«é–¢ã—ã¦ã¯è‡ªåˆ†ã®å¥½ããªå®šç¾©åã‚’å®£è¨€ã§ãã¾ã™ã€‚

ã¾ãŸã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯AWSã®ä½•ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã¤ã„ã¦ã®è¨˜è¿°ãªã®ã‹ã€
ã¨è¨€ã†ã“ã¨ã‚’å®£è¨€ã™ã‚‹ãŸã‚ã«æ¬¡ã®è¨˜è¿°ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

```yml
Type: AWS::EC2::VPC
```

ã“ã“ã§ã¯ã€VPCã‚’å®šç¾©ã™ã‚‹ãŸã‚Typeã«VPCã‚’å®£è¨€ã—ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã«ã€`Properties:`ã§ã™ãŒã€ã“ã®äºˆç´„èªä»¥ä¸‹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆåŒºåˆ‡ã‚Šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒVPCã®å®šç¾©ã«å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¼ã‚’è¨˜è¿°ã§ãã¾ã™ã€‚

ã§ã¯é †ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¼ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### CidrBlock

```yml
CidrBlock: 10.0.0.0/16
```
ã“ã“ã§ã¯ã€
ã‚¯ãƒ©ã‚¹ãƒ¬ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ–ãƒ­ãƒƒã‚¯ã‚’å®šç¾©ã—ã¾ã™ã€ä»Šå›ã¯ã‚¯ãƒ©ã‚¹Aã€
`10.0.0.0 ~ 10.255.255.255 ï¼ˆ10.0.0.0/8ï¼‰` ã¨ã—ã¦å®šç¾©ã—ã¦ãŠãã¾ã™ãŒã€ `Cidr`ã¨è¨€ã†åå‰ã®é€šã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¯ãƒ©ã‚¹ã‚’æ·±ãæ„è­˜ã™ã‚‹å¿…è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

ã¡ãªã¿ã«ã€ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã®æ„å‘³ã¯
10.0.0.0/16ã¯ã€10.0.0.0ã‹ã‚‰10.0.255.255ã¾ã§ã®65,536å€‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
256 x 256 = 65,536
8 + 8ãªã®ã§`ç¬¬äºŒã‚ªã‚¯ãƒ†ãƒƒãƒˆ`ã¾ã§ã¨ã„ã†æ„å‘³ã€‚

### EnableDns*

```yml
EnableDnsHostnames: true
```
å˜ç´”ã«DNSãƒ›ã‚¹ãƒˆåã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã®å®£è¨€ã§ã™ã€‚

```yml
EnableDnsSupport: true
```
ã“ã¡ã‚‰ã‚‚å˜ç´”ã«DNSã‚µãƒãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹å¦ã‹ã®å®£è¨€ã§ã™ã€‚

### InstanceTenancy

```yml
InstanceTenancy: default
```
VPCå†…ã«èµ·å‹•ã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®èµ·å‹•æ™‚ã«åˆ¥ã®ãƒ†ãƒŠãƒ³ãƒˆå±æ€§ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªã„é™ã‚Šã€
ä»Šå›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‡å®šã§ã¯å…±æœ‰ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

VPCã«é–¢ã™ã‚‹ãã®ã»ã‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¼ã«é–¢ã—ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¾ã—ã‚‡ã†ã€‚

https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpc.html


## Outputsã‚»ã‚¯ã‚·ãƒ§ãƒ³

```yml
Outputs:
  VpcOut:
    Value: !Ref VPC
    Export:
      Name: CreateVpc
```

ä»–ã®CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å‡ºåŠ›ã—ãŸå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã„ã†å®£è¨€ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã¯ã€ä¾‹ãˆã°ã‚ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ã€åˆ¥ã®ã‚‚ã—ãã¯åŒåã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆåã«ç½®ãæ›ãˆã‚‹ã¨ã€åˆ¥ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã“ã®ãƒªã‚½ãƒ¼ã‚¹ã®IDã‚’å–å¾—ã§ãã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã€ä»–ã®CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã©ã®ã‚ˆã†ã«æ‰±ãˆã°è‰¯ã„ã®ã‹ï¼Ÿ

ãƒã‚¤ãƒ³ãƒˆã¯äºŒã¤ã§ã™ã€‚

- !ImportValue: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆåã€€ã¨ã„ã£ãŸå½¢å¼ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹

- ä»–ã®CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾å­˜ã™ã‚‹Stackã«å½“ãŸã‚‹ã®ã§ã€Outputsã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’å–ã‚Šè¾¼ã‚€ã«ã¯ä¾å­˜é–¢ä¿‚ã‚’è¨­å®šã™ã‚‹

ä¾‹ãˆã°ä»Šå›ä½œæˆã—ãŸVPCã‚’ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã«ã¯æ¬¡ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```yml
Resources:
  VPCGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !ImportValue CreateVpc
      InternetGatewayId: !ImportValue CreateIgw
```

ç°¡å˜ã§ã™ã­ã€ã“ã‚Œã‚’ã‚¯ãƒ­ã‚¹ã‚¹ã‚¿ãƒƒã‚¯ã¨å‘¼ã‚“ã ã‚Šã—ã¾ã™ã€‚
åŒä¸€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§å‚ç…§ã™ã‚‹ã«ã¯`!Ref`ç­‰ã‚’ä½¿ã£ãŸã‚Šã™ã‚‹ã®ã§ã™ãŒã€åŸºæœ¬çš„ã«ã¯åŒã˜è€ƒãˆæ–¹ã§ã™ã€‚
è©³ã—ãã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¾ã—ã‚‡ã†ã€‚

https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html

åŒã˜è¦é ˜ã§ãã®ä»–ã€å¿…è¦ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚

- InternetGateway
- Subnet
- NatGateway
- Route
- SecurityGroup
- EC2
- ELB

## InternetGateway

```yml
AWSTemplateFormatVersion: 2010-09-09
#  _____
# |_   _|
#   | |    __ _ __      __
#   | |   / _` |\ \ /\ / /
#  _| |_ | (_| | \ V  V /
# |_____| \__, |  \_/\_/
#          __/ |
#         |___/
Resources:
  InternetGW:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
      - Key: Name
        Value: cfn-training-igw
Outputs:
  IgwOut:
    Value: !Ref InternetGW
    Export:
      Name: CreateIgw
```

## Subnet

```yml
AWSTemplateFormatVersion: 2010-09-09
#   _____         _                   _
#  / ____|       | |                 | |
# | (___   _   _ | |__   _ __    ___ | |_
#  \___ \ | | | || '_ \ | '_ \  / _ \| __|
#  ____) || |_| || |_) || | | ||  __/| |_
# |_____/  \__,_||_.__/ |_| |_| \___| \__|
Resources:
  VPCGatewayAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !ImportValue CreateVpc
      InternetGatewayId: !ImportValue CreateIgw
  PublicSubnet1a:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}a
      CidrBlock: 10.0.0.0/24
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: cfn-training-publicsubnet1a
      VpcId: !ImportValue CreateVpc
  PublicSubnet1c:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}c
      CidrBlock: 10.0.1.0/24
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: cfn-training-publicsubnet1c
      VpcId: !ImportValue CreateVpc
  PublicSubnet1d:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}d
      CidrBlock: 10.0.2.0/24
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: cfn-training-publicsubnet1d
      VpcId: !ImportValue CreateVpc
  PrivateSubnet1a:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}a
      CidrBlock: 10.0.10.0/24
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: cfn-training-privatesubnet1a
      VpcId: !ImportValue CreateVpc
  PrivateSubnet1c:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}c
      CidrBlock: 10.0.11.0/24
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: cfn-training-privatesubnet1c
      VpcId: !ImportValue CreateVpc
  PrivateSubnet1d:
    Type: AWS::EC2::Subnet
    DependsOn: VPCGatewayAttachment
    Properties:
      AvailabilityZone: !Sub ${AWS::Region}d
      CidrBlock: 10.0.20.0/24
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: cfn-training-privatesubnet1d
      VpcId: !ImportValue CreateVpc
Outputs:
  PublicSubnet1aOut:
    Value: !Ref PublicSubnet1a
    Export:
      Name: CreatePublicSubnet1a
  PublicSubnet1cOut:
    Value: !Ref PublicSubnet1c
    Export:
      Name: CreatePublicSubnet1c
  PublicSubnet1dOut:
    Value: !Ref PublicSubnet1d
    Export:
      Name: CreatePublicSubnet1d
  PrivateSubnet1aOut:
    Value: !Ref PrivateSubnet1a
    Export:
      Name: CreatePrivateSubnet1a
  PrivateSubnet1cOut:
    Value: !Ref PrivateSubnet1c
    Export:
      Name: CreatePrivateSubnet1c
  PrivateSubnet1dOut:
    Value: !Ref PrivateSubnet1d
    Export:
      Name: CreatePrivateSubnet1d
```

## NatGateway

```yml
AWSTemplateFormatVersion: 2010-09-09
#  _   _         _     _____ __          __
# | \ | |       | |   / ____|\ \        / /
# |  \| |  __ _ | |_ | |  __  \ \  /\  / /
# | . ` | / _` || __|| | |_ |  \ \/  \/ /
# | |\  || (_| || |_ | |__| |   \  /\  /
# |_| \_| \__,_| \__| \_____|    \/  \/
Resources:
  NATGateway1a:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt EIP1a.AllocationId
      SubnetId: !ImportValue CreatePublicSubnet1a
      Tags:
        - Key: Name
          Value: cfn-training-nat-gateway-1a
  EIP1a:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: cfn-training-eip-1a
  NATGateway1c:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt EIP1c.AllocationId
      SubnetId: !ImportValue CreatePublicSubnet1c
      Tags:
        - Key: Name
          Value: cfn-training-nat-gateway-1c
  EIP1c:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: cfn-training-eip-1c
  NATGateway1d:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt EIP1d.AllocationId
      SubnetId: !ImportValue CreatePublicSubnet1d
      Tags:
        - Key: Name
          Value: cfn-training-nat-gateway-1d
  EIP1d:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: cfn-training-eip-1d
Outputs:
  NATGateway1aOut:
    Value: !Ref NATGateway1a
    Export:
      Name: CreateNATGateway1a
  NATGateway1cOut:
    Value: !Ref NATGateway1c
    Export:
      Name: CreateNATGateway1c
  NATGateway1dOut:
    Value: !Ref NATGateway1d
    Export:
      Name: CreateNATGateway1d
```

## Route

```yml
AWSTemplateFormatVersion: 2010-09-09
#  _____                 _
# |  __ \               | |
# | |__) |  ___   _   _ | |_   ___
# |  _  /  / _ \ | | | || __| / _ \
# | | \ \ | (_) || |_| || |_ |  __/
# |_|  \_\ \___/  \__,_| \__| \___|
Resources:
  RouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !ImportValue CreateVpc
      Tags:
      - Key: Name
        Value: cfn-training-route-table
  InternetGWRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref RouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !ImportValue CreateIgw
  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      Tags:
        - Key: Name
          Value: cfn-training-public-route-table
      VpcId: !ImportValue CreateVpc
  PublicRoute:
    Type: AWS::EC2::Route
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !ImportValue CreateIgw
      RouteTableId: !Ref PublicRouteTable
  PrivateRouteTable1a:
    Type: AWS::EC2::RouteTable
    Properties:
      Tags:
        - Key: Name
          Value: cfn-training-private-route-table-1a
      VpcId: !ImportValue CreateVpc
  PrivateRoute1a:
    Type: AWS::EC2::Route
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !ImportValue CreateNATGateway1a
      RouteTableId: !Ref PrivateRouteTable1a
  PrivateRouteTable1c:
    Type: AWS::EC2::RouteTable
    Properties:
      Tags:
        - Key: Name
          Value: cfn-training-private-route-table-1c
      VpcId: !ImportValue CreateVpc
  PrivateRoute1c:
    Type: AWS::EC2::Route
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !ImportValue CreateNATGateway1c
      RouteTableId: !Ref PrivateRouteTable1c
  PrivateRouteTable1d:
    Type: AWS::EC2::RouteTable
    Properties:
      Tags:
        - Key: Name
          Value: cfn-training-private-route-table-1d
      VpcId: !ImportValue CreateVpc
  PrivateRoute1d:
    Type: AWS::EC2::Route
    Properties:
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !ImportValue CreateNATGateway1d
      RouteTableId: !Ref PrivateRouteTable1d
  PublicSubnet1aRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !ImportValue CreatePublicSubnet1a
  PublicSubnet1cRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !ImportValue CreatePublicSubnet1c
  PublicSubnet1dRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PublicRouteTable
      SubnetId: !ImportValue CreatePublicSubnet1d
  PrivateSubnet1aRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable1a
      SubnetId: !ImportValue CreatePrivateSubnet1a
  PrivateSubnet1cRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable1c
      SubnetId: !ImportValue CreatePrivateSubnet1c
  PrivateSubnet1dRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref PrivateRouteTable1d
      SubnetId: !ImportValue CreatePrivateSubnet1d
  VPCGatewayEndpoint:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      RouteTableIds:
        - !Ref PrivateRouteTable1a
        - !Ref PrivateRouteTable1c
        - !Ref PrivateRouteTable1d
        - !Ref PublicRouteTable
      ServiceName: !Sub com.amazonaws.${AWS::Region}.s3
      VpcId: !ImportValue CreateVpc
```

## SecurityGroup

```yml
AWSTemplateFormatVersion: 2010-09-09
#   _____               _____
#  / ____|             / ____|
# | (___    ___   ___ | |  __  _ __
#  \___ \  / _ \ / __|| | |_ || '_ \
#  ____) ||  __/| (__ | |__| || |_) |
# |_____/  \___| \___| \_____|| .__/
#                             | |
#                             |_|
Resources:
  SecurityGp:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: DefaultRule
      VpcId: !ImportValue CreateVpc
      SecurityGroupIngress:
        - { IpProtocol: tcp, FromPort: 22, ToPort: 22, CidrIp: 0.0.0.0/0 }
        - { IpProtocol: tcp, FromPort: 80, ToPort: 80, CidrIp: 0.0.0.0/0 }
  ELBSecurityGp:
    Type: AWS::EC2::SecurityGroup
    Properties:
      VpcId: !ImportValue CreateVpc
      GroupDescription: "-"
      SecurityGroupIngress:
        - { IpProtocol: tcp, FromPort: 80, ToPort: 80, CidrIp: 0.0.0.0/0 }
        - { IpProtocol: tcp, FromPort: 443, ToPort: 443, CidrIp: 0.0.0.0/0 }
Outputs:
  SecurityGpOut:
    Value: !Ref SecurityGp
    Export:
      Name: CreateSecGp
  ELBSecurityGpOut:
    Value: !Ref ELBSecurityGp
    Export:
      Name: CreateELBSecGp
```

## EC2

```yml
AWSTemplateFormatVersion: 2010-09-09
# | __|  __|_  )
# | _|  (     /   Amazon Linux 2 AMI
# |___|\___|___|
Parameters:
  EC2InstanceType:
    Type: String
    Default: t2.nano
  EC2KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: SSH public key
    Default: cfn-training
Resources:
  EC2Instance1a:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-097473abce069b8e9
      InstanceType: !Ref EC2InstanceType
      KeyName: !Ref EC2KeyName
      SubnetId: !ImportValue CreatePublicSubnet1a
      SecurityGroupIds:
        - !ImportValue CreateSecGp
      UserData: !Base64 |
        #! /bin/bash
        yum update -y
        amazon-linux-extras install nginx1.12 -y
        systemctl start nginx
        systemctl enable nginx
      Tags:
        - Key: Name
          Value: cfn-training-ec2-1a
  EC2Instance1c:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-097473abce069b8e9
      InstanceType: !Ref EC2InstanceType
      KeyName: !Ref EC2KeyName
      SubnetId: !ImportValue CreatePublicSubnet1c
      SecurityGroupIds:
        - !ImportValue CreateSecGp
      UserData: !Base64 |
        #! /bin/bash
        yum update -y
        amazon-linux-extras install nginx1.12 -y
        systemctl start nginx
        systemctl enable nginx
      Tags:
        - Key: Name
          Value: cfn-training-ec2-1c
  EC2Instance1d:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-097473abce069b8e9
      InstanceType: !Ref EC2InstanceType
      KeyName: !Ref EC2KeyName
      SubnetId: !ImportValue CreatePublicSubnet1d
      SecurityGroupIds:
        - !ImportValue CreateSecGp
      UserData: !Base64 |
        #! /bin/bash
        yum update -y
        amazon-linux-extras install nginx1.12 -y
        systemctl start nginx
        systemctl enable nginx
      Tags:
        - Key: Name
          Value: cfn-training-ec2-1d
Outputs:
  Region:
    Value: !Ref AWS::Region
  EC2Instance1a:
    Value: !Ref EC2Instance1a
    Export:
      Name: CreateEC21a
  EC2Instance1c:
    Value: !Ref EC2Instance1c
    Export:
      Name: CreateEC21c
  EC2Instance1d:
    Value: !Ref EC2Instance1d
    Export:
      Name: CreateEC21d
```

## CLB

```yml
AWSTemplateFormatVersion: 2010-09-09
Description: Create CLB
Resources:
  InternetELB:
    Type: AWS::ElasticLoadBalancing::LoadBalancer
    Properties:
      LoadBalancerName: cfn-training-elb
      Scheme: internet-facing
      CrossZone: true
      HealthCheck:
        Target: "TCP:80"
        HealthyThreshold: "2"
        UnhealthyThreshold: "2"
        Interval: "30"
        Timeout: "5"
      Listeners:
        - LoadBalancerPort: "80"
          InstancePort: "80"
          Protocol: HTTP
      Instances:
        - !ImportValue CreateEC21a
        - !ImportValue CreateEC21c
        - !ImportValue CreateEC21d
      SecurityGroups:
        - !ImportValue CreateELBSecGp
      Subnets:
        - Fn::ImportValue: CreatePublicSubnet1a
        - Fn::ImportValue: CreatePublicSubnet1c
        - Fn::ImportValue: CreatePublicSubnet1d
```

æœ€å¾Œã«ã“ã‚Œã‚‰ãƒ‘ãƒ¼ãƒ„ã‚’ä½¿ã£ã¦å…ˆç¨‹ã®æ§‹æˆå›³ã®ã‚ˆã†ãªç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã—ã‚‡ã†ã€‚
ä»Šå›ã¯ãƒ«ãƒ¼ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã¨ã—ã¦å®šç¾©ã—ã€å®Ÿéš›ã«deployã¾ã§ã—ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€ãƒ«ãƒ¼ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¨˜è¿°ã—ã¾ã—ã‚‡ã†ã€‚
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```bash
template
â”œâ”€â”€ child_stack_template
â”‚Â Â  â”œâ”€â”€ alb.yml
â”‚Â Â  â”œâ”€â”€ autoscaling.yml
â”‚Â Â  â”œâ”€â”€ clb.yml
â”‚Â Â  â”œâ”€â”€ ec2.yml
â”‚Â Â  â”œâ”€â”€ internetgateway.yml
â”‚Â Â  â”œâ”€â”€ natgateway.yml
â”‚Â Â  â”œâ”€â”€ nlb.yml
â”‚Â Â  â”œâ”€â”€ route.yml
â”‚Â Â  â”œâ”€â”€ securitygroup.yml
â”‚Â Â  â”œâ”€â”€ subnet.yml
â”‚Â Â  â””â”€â”€ vpc.yml
â””â”€â”€ root-stack.yml
```

ãƒ«ãƒ¼ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```yml
AWSTemplateFormatVersion: "2010-09-09"
#  _____                 _     _____  _                 _
# |  __ \               | |   / ____|| |               | |
# | |__) |  ___    ___  | |_ | (___  | |_   __ _   ___ | | __
# |  _  /  / _ \  / _ \ | __| \___ \ | __| / _` | / __|| |/ /
# | | \ \ | (_) || (_) || |_  ____) || |_ | (_| || (__ |   <
# |_|  \_\ \___/  \___/  \__||_____/  \__| \__,_| \___||_|\_\
Parameters:
  TemplateVPC:
    Type: String
  TemplateInternetGateway:
    Type: String
  TemplateSubnet:
    Type: String
  TemplateNatGateway:
    Type: String
  TemplateRoute:
    Type: String
  TemplateSecurityGroup:
    Type: String
  TemplateEC2:
    Type: String
  TemplateCLB:
    Type: String
Resources:
  VPC:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateVPC
  InternetGateway:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateInternetGateway
    DependsOn: VPC
  Subnet:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateSubnet
    DependsOn: InternetGateway
  NatGateway:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateNatGateway
    DependsOn: Subnet
  Route:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateRoute
    DependsOn: NatGateway
  SecurityGroup:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateSecurityGroup
    DependsOn: Route
  EC2:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateEC2
    DependsOn: SecurityGroup
  CLB:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Ref TemplateCLB
    DependsOn: EC2
```

## ãƒ‡ãƒ—ãƒ­ã‚¤

ãƒ«ãƒ¼ãƒˆã‚¹ã‚¿ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæº–å‚™ã§ããŸã‚‰æ¬¡ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ã„ãã¤ã‹æ–¹æ³•ãŒã‚ã£ã¦ã€AWSãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç”¨ã„ã‚‹æ–¹æ³•ãŒä¸€èˆ¬çš„ã ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã¯AWS CLIã‚’ç”¨ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## S3ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ã“ã®ã‚ˆã†ãªå½¢ã§ShellScriptã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã­ã€‚

```bash
#!/bin/sh -eux

readonly BUCKETNAME
readonly REGIONNAME
aws s3api create-bucket \
  --bucket "${BUCKETNAME}" \
  --create-bucket-configuration "LocationConstraint=${REGIONNAME}"
aws s3api list-buckets

```

## ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
#!/bin/sh -eux

readonly BUCKETNAME
aws s3 sync template/child_stack_template "s3://${BUCKETNAME}"/

readonly REGIONNAME
readonly STACKNAME
readonly FILENAME="template/root-stack.yml"
readonly S3URL
echo "${S3URL}"
changeset_option=""

aws cloudformation validate-template --template-body file://${FILENAME}

aws cloudformation deploy \
    ${changeset_option} \
    --stack-name "${STACKNAME}" \
    --template-file "${FILENAME}" \
    --parameter-overrides \
      TemplateVPC="${S3URL}/vpc.yml" \
      TemplateInternetGateway="${S3URL}/internetgateway.yml" \
      TemplateSubnet="${S3URL}/subnet.yml" \
      TemplateNatGateway="${S3URL}/natgateway.yml" \
      TemplateRoute="${S3URL}/route.yml" \
      TemplateSecurityGroup="${S3URL}/securitygroup.yml" \
      TemplateEC2="${S3URL}/ec2.yml" \
      TemplateCLB="${S3URL}/clb.yml"
```

æœ€å¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«AWSãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã‚‚ç¢ºèªã§ãã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-08-23 12.18.32.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1009976/d0769691-7569-ceda-bdd2-413527334d3c.png)


ä»Šå›ã¯å„EC2ã«ã‚ã‚‰ã‹ã˜ã‚Nginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãªã®ã§æ¬¡ã®ã‚ˆã†ã«CLBã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã“ã®ã‚ˆã†ãªwelcomeãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚


![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-08-30 11.19.55.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1009976/bf3c2e90-574c-edb9-eb6b-0817119b871c.png)

ã¾ãŸãƒˆãƒªãƒ—ãƒ«AZæ§‹æˆã‹ã©ã†ã‹ã¯hostã‚³ãƒãƒ³ãƒ‰ç­‰ã‚’æ‰“ã£ã¦ã¿ã‚‹ã¨ã‚ˆã‚Šå®Ÿæ„Ÿã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

```bash
host cfn-training-elb-çœç•¥.ap-northeast-1.elb.amazonaws.com
cfn-training-elb-çœç•¥.ap-northeast-1.elb.amazonaws.com has address 35.XX.çœç•¥
cfn-training-elb-çœç•¥.ap-northeast-1.elb.amazonaws.com has address 13.XX.çœç•¥
cfn-training-elb-çœç•¥.ap-northeast-1.elb.amazonaws.com has address 54.XX.çœç•¥

```

# æœ€å¾Œã«
ä»Šå›ä½œæˆã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¯ã€AWSã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹çš„ã«ã¯éæ¨å¥¨ã®æ§‹æˆãŒã‚ã‚Šã¾ã™ã€‚
ãŠæ°—ã¥ãã§ã™ã­ã€CLBï¼ˆã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ï¼‰ã®åˆ©ç”¨ã¯å¥½ã¾ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ALBã«æ›¸ãæ›ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ã“ã‚“ãªæ„Ÿã˜ã§ã€æ‰‹ã‚’å‹•ã‹ã—ã¦ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ”¹è‰¯ã—ã¦ã„ãã“ã¨ã§CloudFormationã®æ„Ÿè¦šã‚’æ´ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯EC2ã«ãƒãƒ«ãƒAZæ§‹æˆã¨è¨€ã†æ˜”ãªãŒã‚‰ã®ç‹é“ãªæ§‹æˆã§ã—ãŸãŒã€ãã‚‚ãã‚‚ã“ã®æ§‹æˆã¯çŠ¶æ³ã«ã‚ˆã‚Šå¿…ãšã—ã‚‚ã‚³ã‚¹ãƒˆæœ€é©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã¨è¨€ã†ã“ã¨ã§ã€æ¬¡å›ã¯SAMã«ãŠã‘ã‚‹CloudFormationã®æ›¸ãæ–¹ç­‰ã‚’ã¾ã¨ã‚ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

å‚è€ƒæ–‡çŒ®

- ã€ŒINTRODUCTION TO AMAZON ECSã€https://ecs-for-aws-summit-online.workshop.aws/
- ã€ŒAWS ã‚µãƒ³ãƒ—ãƒ«ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/sample-templates-applications-ap-northeast-1.html
- ã€Œçµ„ã¿è¾¼ã¿é–¢æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html
- ã€Œã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã‚’ä½œæˆã€https://rakko.tools/tools/68/
- ã€ŒElastic Load Balancing ã®ç‰¹å¾´ã€https://aws.amazon.com/jp/elasticloadbalancing/features/
- ã€ŒCloudFormationã§ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½œæˆã—ã¦ã¿ã‚‹ã€https://dev.classmethod.jp/articles/create-own-verification-environment-using-cfn-nested-stacks/
- ã€Œå½¢å¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã€€https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/format-version-structure.html

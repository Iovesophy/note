---
title: "TypeScript ã§ãƒŸãƒ‹ãƒžãƒ  ls ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚ã†"
emoji: "ðŸ“–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["TypeScript", "Deno"]
published: true
---

# TypeScript ã§ãƒŸãƒ‹ãƒžãƒ  ls ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚ã†

## ã‚ã‚‰ã¾ã—

æœ¬å¹´åº¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚’å‹™ã‚ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã€ç ”ä¿®èª²é¡Œç”¨æ•™æã‚’ã„ãã¤ã‹ä½œæˆã—ãŸå†…ã®ä¸€ã¤ã§ã‚ã‚‹ã€‚
ä»Šå›žã¯ TypeScript ã¨ Deno ã‚’ä½¿ã£ã¦ ãƒŸãƒ‹ãƒžãƒ ãª ls ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚‹èª²é¡Œã‚’è€ƒãˆãŸã€‚
èª²é¡Œä½œæˆã«ã¯ `ls -GF` ã‚³ãƒžãƒ³ãƒ‰ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã‚’å¾—ã¦ã„ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d0f103b9beb2-20221003.png)

## èª²é¡Œè³‡æ–™

### minils

### æ¦‚è¦

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒªã‚¹ãƒˆã™ã‚‹

### å‰æ

- ã‚³ãƒžãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€å¤šãƒã‚¤ãƒˆæ–‡å­—ã¯è€ƒæ…®ã—ãªã„

### ä»•æ§˜

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ Deno ã‚’ä½¿ç”¨
- è¨€èªžã¯ TypeScript ã‚’ä½¿ç”¨
- Docker ä¸¦ã³ã« Docker Compose ã‚’ç”¨ã„ã¦ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’å®šç¾©ã™ã‚‹ã“ã¨

#### åŸºæœ¬

- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¨ãƒ³ãƒˆãƒªã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãŠã‚ˆã³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’å–å¾—ã™ã‚‹
- ãƒ‰ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ãªã„
- ã‚³ãƒžãƒ³ãƒ‰ã®ç¬¬ 1 å¼•æ•°ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã‚’å…¥åŠ›
- ã‚³ãƒžãƒ³ãƒ‰ã®ç¬¬ 1 å¼•æ•°ã«å…¥åŠ›ãŒãªã„å ´åˆã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å…¥åŠ›
- ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã«ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ 2 ã«å‡ºåŠ›
- ãƒ•ã‚¡ã‚¤ãƒ«åã®è‰²ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²ã§å‡ºåŠ›
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¯é’è‰²ã§å‡ºåŠ›
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåæœ«å°¾ã« / ã‚’å‡ºåŠ›(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²)
- æœ€å¤§æ–‡å­—æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’ 2 ã¤è¿½åŠ ã¾ãŸã¯æœ«å°¾ã« / ã‚’å«ã‚ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’ 1 ã¤è¿½åŠ ã—ãŸæ–‡å­—æ•°ã‚’ç®—å‡ºã™ã‚‹(ä»¥ä¸‹ã€ã“ã®æ–‡å­—åˆ—æ•°ã‚’ã€Œæœ€å¤§åå‰ã‚µã‚¤ã‚ºã€ã¨å‘¼ã¶)
- æœ€å¤§åå‰ã‚µã‚¤ã‚ºã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã¾ãŸã¯æœ«å°¾ã« / ã‚’å«ã‚ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®æ–‡å­—æ•°ã‚’å¼•ã„ãŸæ•°ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãã‚Œãžã‚Œã®ãƒªã‚¹ãƒˆã™ã‚‹è¦ç´ ã®æœ«å°¾ã«å‡ºåŠ›
- æœ€å¤§åˆ—æ•°ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã¨æœ€å¤§åå‰ã‚µã‚¤ã‚ºã«ã¦ç®—å‡ºã™ã‚‹
- æœ€å¤§è¡Œæ•°ã‚’ãƒ‰ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ•°ã¨æœ€å¤§åˆ—æ•°ã«ã¦ç®—å‡ºã™ã‚‹
- ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆ
- æœ€å¤§è¡Œæ•°ã¾ã§åˆ—ã«å‡ºåŠ›
- åˆ—ã®æœ€å¤§è¡Œæ•°ã‚’è¶…ãˆãŸã‚‰æ¬¡ã®åˆ—ã«å‡ºåŠ›

#### ãã®ä»–

- ä¸Šè¨˜ä»•æ§˜ã«ã¤ã„ã¦ä¸æ˜Žç‚¹ã€ä¸è¶³ãŒã‚ã‚Œã°ãƒ¡ãƒ³ã‚¿ãƒ¼ã«ç›¸è«‡

## è§£ç­”

é–‹ç™ºç’°å¢ƒã‚’ Docker ã‚„ã€€ Docker Compose ã‚’æ´»ç”¨ã—ã¦ã€äº’æ›æ€§ã®ã‚ã‚‹é–‹ç™ºç’°å¢ƒã‚’ç”¨æ„ã§ãã‚‹èƒ½åŠ›ã‚’èº«ã«ã¤ã‘ã•ã›ãŸã„ã€‚
ã¾ãŸã€TypeScript ã‚’ç”¨ã„ã¦åž‹å®šç¾©ã‚’æ„è­˜ã•ã›ã‚‹ã¨ã„ã†ã“ã¨ã€ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚’æ„è­˜ã§ãã‚‹ã‹ãªã©ã‚’ç›®çš„ã¨ã—ã¦ã„ã‚‹ã€‚

### Docker , Docker Compose ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒã®ç”¨æ„

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.
â”œâ”€â”€ Makefile
â”œâ”€â”€ deno
â”‚Â Â  â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ minils.ts
```

ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®å®šç¾©

```Docker:Dockerfile
FROM denoland/deno:latest

RUN apt update && apt install -y zip
```

Docker Compose ã®å®šç¾©

```Docker:docker-compose.yml
version: "3.8"
services:
  deno:
    build:
      context: deno
      dockerfile: Dockerfile
    volumes:
      - .:/app
```

Makefile ã®ç”¨æ„

```Makefile:Makefile
.PHONY: build
build:
	docker compose build

.PHONY: test
test: compile
	./minils testdir

.PHONY: compile
compile:
	docker compose run deno bash -c "cd /app && deno compile --target x86_64-apple-darwin --allow-read --allow-run minils.ts"
```

### ls ã‚³ãƒžãƒ³ãƒ‰ã®ä½œæˆ

ã¾ãšã€è‰²ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚„ã€éƒ¨å“ã‚’ã‚³ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆã«å®šç¾©ã—ã¦ãŠãã€‚

```TypeScript:minils.ts
const color: {
  Blue: string;
  Reset: string;
} = { Blue: "\u001b[34m", Reset: "\u001b[0m" };

const parts: {
  OneSpace: string;
  Slash: string;
  NewLine: string;
  Dot: string;
  Empty: string;
} = { OneSpace: " ", Slash: "/", NewLine: "\n", Dot: ".", Empty: "" };
```

æ¬¡ã«ã€`interface` ã‚’å®šç¾©ã™ã‚‹

```TypeScript:minils.ts
interface OSOriginListEntry extends Deno.DirEntry {
  name: string;
}

interface DotCheckedMax {
  entry: OSOriginListEntry;
  size: number;
}

interface EditedDotCheckedMax {
  entry: OSOriginListEntry;
  size: number;
}

interface ViewMatrix {
  rowsize: number;
  colsize: number;
}
```

ã¾ãŸã€callback ã«æ¸¡ã™ `print` é–¢æ•°ã«å¯¾ã—ã¦åž‹ã‚’ã‚ã‚‰ã‹ã˜ã‚å®£è¨€ã—ã¦ãŠãã€‚

```TypeScript:minils.ts
type Print = typeof print;
```

```TypeScript:minils.ts
const print = (filename: string, next: boolean) => {
  if (next) {
    Deno.stdout.write(new TextEncoder().encode(filename + parts.NewLine));
  } else {
    Deno.stdout.write(new TextEncoder().encode(filename));
  }
};
```

Dotfile ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã€‚

```TypeScript:minils.ts
const dotCheck = (filename: string) => {
  if (filename.indexOf(parts.Dot)) {
    return true;
  }
  return false;
};
```

å¼•æ•°ã‹ã‚‰ä¸Žãˆã‚‰ã‚ŒãŸãƒ‘ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã€‚
å…¥åŠ›ãŒãªã‘ã‚Œã°ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¡¨ã™ `.` ã‚’è¿”ã™ã€‚

```TypeScript:minils.ts
const pathCheck = (path: string) => {
  if (path === undefined) {
    return parts.Dot;
  }
  return path;
};
```

`tput` ã‚³ãƒžãƒ³ãƒ‰ã§ window ã‚µã‚¤ã‚ºã‚’å–å¾—ã™ã‚‹ã€‚

```TypeScript:minils.ts
const tpusCols = async () => {
  const cmd = Deno.run({ cmd: ["tput", "cols"], stdout: "piped" });
  const columnsUintArray = await cmd.output();
  cmd.close();

  // Decode geted window size with tput cols and cast from decoded string to number
  return Number(new TextDecoder().decode(columnsUintArray));
};
```

`main` é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã€‚
ã“ã“ã§ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¨ãƒ³ãƒˆãƒªã‹ã‚‰èª­ã¿å‡ºã—ãŸæƒ…å ±ã‚’ä¸è¦ãª 2 æ¬¡å…ƒé…åˆ—ã‚’ä½œã‚‰ã›ãªã„ã§ã‚½ãƒ¼ãƒˆã€æŠ½å‡ºã—ã¦è¡Œåˆ—ã«å‡ºåŠ›ã•ã›ã‚‹ã“ã¨ã€‚
ã“ã‚Œã«ã‚ˆã‚Šä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã€è¨ˆç®—ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã§ãã‚‹ã“ã¨ã‚’ç†è§£ã•ã›ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4f03b6c891f5-20221003.png)

```TypeScript:minils.ts
const main = async (path: string, windowsize: number, callback: Print) => {
  const OSEntriesWithoutDotfiles: OSOriginListEntry[] = [];
  for await (const directoryEntry of Deno.readDir(pathCheck(path))) {
    if (dotCheck(directoryEntry.name)) {
      OSEntriesWithoutDotfiles.push(directoryEntry);
    }
  }

  // initialize Max
  const maxentry = OSEntriesWithoutDotfiles.reduce((a, b) =>
    a.name.length > b.name.length ? a : b
  );
  const Max: DotCheckedMax = {
    entry: maxentry,
    size: maxentry.name.length,
  };
  const EditedMax: EditedDotCheckedMax = { entry: Max.entry, size: Max.size };
  EditedMax.size += 2;

  // calc col and row size
  const Matrix: ViewMatrix = { rowsize: 0, colsize: 0 };
  Matrix.colsize = Math.floor(windowsize / EditedMax.size);
  Matrix.rowsize = Math.ceil(OSEntriesWithoutDotfiles.length / Matrix.colsize);

  // extract 2 vector directory entry from 1 vector directory entry
  OSEntriesWithoutDotfiles.sort((a, b) => (a.name > b.name ? 1 : -1));
  for (let i = 0; i < Matrix.rowsize; i++) {
    if (i != 0) {
      callback(parts.Empty, true);
    }
    for (let j = i; j < Matrix.colsize * Matrix.rowsize; j += Matrix.rowsize) {
      if (OSEntriesWithoutDotfiles[j] === undefined) {
        break;
      }
      // region layout
      const addSize = Max.size - OSEntriesWithoutDotfiles[j].name.length;
      let sizewithslash = 1;
      if (OSEntriesWithoutDotfiles[j].isDirectory) {
        OSEntriesWithoutDotfiles[j].name =
          color.Blue +
          OSEntriesWithoutDotfiles[j].name +
          color.Reset +
          parts.Slash;
        sizewithslash -= 1;
      }
      for (let k = 0; k <= addSize + sizewithslash; k++) {
        OSEntriesWithoutDotfiles[j].name += parts.OneSpace;
      }
      // endregion layout
      callback(OSEntriesWithoutDotfiles[j].name, false);
    }
  }
};
```

æœ€å¾Œã« `Deno` ã® top level await ãªã©ã‚’æ´»ç”¨ã—ãªãŒã‚‰ main é–¢æ•°ç­‰ã‚’å‘¼ã³å‡ºã™ã€‚
ã¾ãŸã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã€‚

```TypeScript:minils.ts
try {
  // top level await with Deno
  const windowsize = await tpusCols();
  await main(Deno.args[0], windowsize, print);
  print(parts.Empty, true);
} catch (e) {
  console.error(e.message);
}
```

å…¨ä½“åƒ

```TypeScript:minils.ts
const color: {
  Blue: string;
  Reset: string;
} = { Blue: "\u001b[34m", Reset: "\u001b[0m" };

const parts: {
  OneSpace: string;
  Slash: string;
  NewLine: string;
  Dot: string;
  Empty: string;
} = { OneSpace: " ", Slash: "/", NewLine: "\n", Dot: ".", Empty: "" };

interface OSOriginListEntry extends Deno.DirEntry {
  name: string;
}

interface DotCheckedMax {
  entry: OSOriginListEntry;
  size: number;
}

interface EditedDotCheckedMax {
  entry: OSOriginListEntry;
  size: number;
}

interface ViewMatrix {
  rowsize: number;
  colsize: number;
}

type Print = typeof print;

const print = (filename: string, next: boolean) => {
  if (next) {
    Deno.stdout.write(new TextEncoder().encode(filename + parts.NewLine));
  } else {
    Deno.stdout.write(new TextEncoder().encode(filename));
  }
};

const dotCheck = (filename: string) => {
  if (filename.indexOf(parts.Dot)) {
    return true;
  }
  return false;
};

const pathCheck = (path: string) => {
  if (path === undefined) {
    return parts.Dot;
  }
  return path;
};

const tpusCols = async () => {
  const cmd = Deno.run({ cmd: ["tput", "cols"], stdout: "piped" });
  const columnsUintArray = await cmd.output();
  cmd.close();

  // Decode geted window size with tput cols and cast from decoded string to number
  return Number(new TextDecoder().decode(columnsUintArray));
};

const main = async (path: string, windowsize: number, callback: Print) => {
  const OSEntriesWithoutDotfiles: OSOriginListEntry[] = [];
  for await (const directoryEntry of Deno.readDir(pathCheck(path))) {
    if (dotCheck(directoryEntry.name)) {
      OSEntriesWithoutDotfiles.push(directoryEntry);
    }
  }

  // initialize Max
  const maxentry = OSEntriesWithoutDotfiles.reduce((a, b) =>
    a.name.length > b.name.length ? a : b
  );
  const Max: DotCheckedMax = {
    entry: maxentry,
    size: maxentry.name.length,
  };
  const EditedMax: EditedDotCheckedMax = { entry: Max.entry, size: Max.size };
  EditedMax.size += 2;

  // calc col and row size
  const Matrix: ViewMatrix = { rowsize: 0, colsize: 0 };
  Matrix.colsize = Math.floor(windowsize / EditedMax.size);
  Matrix.rowsize = Math.ceil(OSEntriesWithoutDotfiles.length / Matrix.colsize);

  // extract 2 vector directory entry from 1 vector directory entry
  OSEntriesWithoutDotfiles.sort((a, b) => (a.name > b.name ? 1 : -1));
  for (let i = 0; i < Matrix.rowsize; i++) {
    if (i != 0) {
      callback(parts.Empty, true);
    }
    for (let j = i; j < Matrix.colsize * Matrix.rowsize; j += Matrix.rowsize) {
      if (OSEntriesWithoutDotfiles[j] === undefined) {
        break;
      }
      // region layout
      const addSize = Max.size - OSEntriesWithoutDotfiles[j].name.length;
      let sizewithslash = 1;
      if (OSEntriesWithoutDotfiles[j].isDirectory) {
        OSEntriesWithoutDotfiles[j].name =
          color.Blue +
          OSEntriesWithoutDotfiles[j].name +
          color.Reset +
          parts.Slash;
        sizewithslash -= 1;
      }
      for (let k = 0; k <= addSize + sizewithslash; k++) {
        OSEntriesWithoutDotfiles[j].name += parts.OneSpace;
      }
      // endregion layout
      callback(OSEntriesWithoutDotfiles[j].name, false);
    }
  }
};

try {
  // top level await with Deno
  const windowsize = await tpusCols();
  await main(Deno.args[0], windowsize, print);
  print(parts.Empty, true);
} catch (e) {
  console.error(e.message);
}
```

## ã¾ã¨ã‚

ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å…¥é–€ã¨ã—ã¦ 100 è¡Œã‚’å°‘ã—è¶…ãˆã‚‹ç¨‹åº¦ãªã®ã§ã¡ã‚‡ã†ã©è‰¯ã„ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
Deno ã‚„ TypeScript ãªã©ã€æ¯”è¼ƒçš„æ–°ã—ã„æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ã£ã¦å­¦ç¿’è€…ã®èˆˆå‘³é–¢å¿ƒã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚‚å›³ã‚Šã¾ã—ãŸã€‚
ä»Šå›žã¯ã€ã“ã‚Œä»¥å¤–ã«ã‚‚èª²é¡Œã‚’ä¸Žãˆã¦ã„ãŸã®ã§ã€ãƒ†ã‚¹ãƒˆãªã©ã¯çœãã¾ã—ãŸãŒã€æ¬¡å›žã¯ãƒ†ã‚¹ãƒˆã®è¨˜è¿°ãªã©ã‚‚ç››ã‚Šè¾¼ã¿ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚

ä»Šå›žã®ã‚½ãƒ¼ã‚¹ã¯ã“ã“ã«æ®‹ã—ã¦ã‚ã‚Šã¾ã™ã€‚

https://github.com/Iovesophy/minils

ä»Šå›žåˆã‚ã¦ãƒ¡ãƒ³ã‚¿ãƒ¼ã¨ã„ã†ã‚‚ã®ã‚’ã‚„ã£ã¦ã¿ã¾ã—ãŸãŒã€è‰²ã€…ã¨ã©ã†ä¼ãˆã‚‹ã¨æœ¬äººã®ãŸã‚ã«ãªã‚‹ã®ã‹æ‚©ã‚€å ´é¢ã‚‚å¤šã€…ã‚ã‚Šã¾ã—ãŸã€‚
ã©ã†ã‹ä»Šå›žã®çµŒé¨“ã‚’ç³§ã«ã€ä¸–ã«è²¢çŒ®ã§ãã‚‹èƒ½åŠ›ã‚’èº«ã«ã¤ã‘ã€å°‘ã—ã§ã‚‚ã”æ´»èºã„ãŸã ã‘ã‚‹åŠ©ã‘ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ã€‚
